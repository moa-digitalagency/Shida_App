{% extends 'admin/base.html' %}

{% block title %}Utilisateurs - Shida Admin{% endblock %}

{% block content %}
<div class="mb-8 flex items-center justify-between">
    <div>
        <h1 class="text-3xl font-bold">Utilisateurs</h1>
        <p class="text-gray-400">Gestion des utilisateurs de l'application</p>
    </div>
</div>

<div class="bg-gray-800 rounded-xl p-4 mb-6">
    <form method="GET" class="flex flex-wrap gap-4">
        <div class="flex-1 min-w-[200px]">
            <input type="text" name="search" value="{{ request.args.get('search', '') }}" 
                   placeholder="Rechercher par nom ou email..."
                   class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-shida-pink focus:outline-none">
        </div>
        
        <select name="status" class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-shida-pink focus:outline-none">
            <option value="all" {% if request.args.get('status') == 'all' %}selected{% endif %}>Tous les statuts</option>
            <option value="active" {% if request.args.get('status') == 'active' %}selected{% endif %}>Actifs</option>
            <option value="banned" {% if request.args.get('status') == 'banned' %}selected{% endif %}>Bannis</option>
            <option value="inactive" {% if request.args.get('status') == 'inactive' %}selected{% endif %}>Inactifs</option>
        </select>
        
        <select name="vip" class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-shida-pink focus:outline-none">
            <option value="all" {% if request.args.get('vip') == 'all' %}selected{% endif %}>Tous</option>
            <option value="yes" {% if request.args.get('vip') == 'yes' %}selected{% endif %}>VIP</option>
            <option value="no" {% if request.args.get('vip') == 'no' %}selected{% endif %}>Non-VIP</option>
        </select>
        
        <button type="submit" class="bg-shida-pink hover:bg-pink-600 text-white px-6 py-2 rounded-lg transition">
            Filtrer
        </button>
    </form>
</div>

<div class="bg-gray-800 rounded-xl overflow-hidden">
    <table class="w-full">
        <thead class="bg-gray-700">
            <tr>
                <th class="text-left px-6 py-4">Utilisateur</th>
                <th class="text-left px-6 py-4">Email</th>
                <th class="text-left px-6 py-4">Statut</th>
                <th class="text-left px-6 py-4">VIP</th>
                <th class="text-left px-6 py-4">Tokens</th>
                <th class="text-left px-6 py-4">Inscrit le</th>
                <th class="text-left px-6 py-4">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users.items %}
            <tr class="border-t border-gray-700 hover:bg-gray-700/50">
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-shida-pink to-purple-600 flex items-center justify-center overflow-hidden">
                            {% if user.profile and user.profile.photo_url %}
                            <img src="{{ user.profile.photo_url }}" class="w-full h-full object-cover">
                            {% else %}
                            {{ user.profile.name[0] if user.profile else 'U' }}
                            {% endif %}
                        </div>
                        <div>
                            <p class="font-medium">{{ user.profile.name if user.profile else 'Sans profil' }}</p>
                            {% if user.profile and user.profile.is_verified %}
                            <span class="text-xs text-green-400 flex items-center gap-1">
                                <i data-feather="check-circle" class="w-3 h-3"></i> Vérifié
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 text-gray-400">{{ user.email }}</td>
                <td class="px-6 py-4">
                    {% if user.is_banned %}
                    <span class="bg-red-500/20 text-red-400 px-2 py-1 rounded text-sm">Banni</span>
                    {% elif user.is_active %}
                    <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-sm">Actif</span>
                    {% else %}
                    <span class="bg-gray-500/20 text-gray-400 px-2 py-1 rounded text-sm">Inactif</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if user.is_vip %}
                    <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-sm">{{ user.vip_type }}</span>
                    {% else %}
                    <span class="text-gray-500">-</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">{{ user.tokens }}</td>
                <td class="px-6 py-4 text-gray-400">{{ user.created_at.strftime('%d/%m/%Y') if user.created_at else '-' }}</td>
                <td class="px-6 py-4">
                    <a href="{{ url_for('admin.user_detail', user_id=user.id) }}" class="text-shida-pink hover:underline">
                        Détails
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-6 py-12 text-center text-gray-400">
                    Aucun utilisateur trouvé
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if users.pages > 1 %}
<div class="flex justify-center gap-2 mt-6">
    {% if users.has_prev %}
    <a href="{{ url_for('admin.users', page=users.prev_num, status=request.args.get('status'), vip=request.args.get('vip'), search=request.args.get('search')) }}" 
       class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">Précédent</a>
    {% endif %}
    
    <span class="px-4 py-2 bg-shida-pink rounded-lg">{{ users.page }} / {{ users.pages }}</span>
    
    {% if users.has_next %}
    <a href="{{ url_for('admin.users', page=users.next_num, status=request.args.get('status'), vip=request.args.get('vip'), search=request.args.get('search')) }}" 
       class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">Suivant</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
